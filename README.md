# DIP - Docker Image Pull

ä¸€ä¸ªæ— éœ€ Docker ç¯å¢ƒå³å¯æ‹‰å– Docker é•œåƒå¹¶ä¿å­˜ä¸º tar æ–‡ä»¶çš„ Go å·¥å…·ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ **æ— éœ€ Docker** - æ— éœ€å®‰è£… Docker å³å¯æ‹‰å–é•œåƒ
- ğŸ”„ **å¹¶å‘ä¸‹è½½** - æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ï¼Œå¤§å¹…æå‡ä¸‹è½½é€Ÿåº¦
- ğŸ” **è‡ªåŠ¨é‡è¯•** - ç½‘ç»œä¸ç¨³å®šæ—¶è‡ªåŠ¨é‡è¯•ï¼Œç¡®ä¿ä¸‹è½½æˆåŠŸ
- âœ… **å®Œæ•´æ€§éªŒè¯** - ä¸‹è½½åè‡ªåŠ¨æ ¡éªŒæ‘˜è¦ï¼Œç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§
- ğŸï¸ **é•œåƒåŠ é€Ÿ** - å†…ç½®å›½å†…é•œåƒåŠ é€Ÿå™¨æ”¯æŒï¼Œæå‡ä¸‹è½½é€Ÿåº¦
- ğŸ“¦ **å±‚ç¼“å­˜** - æ™ºèƒ½ç¼“å­˜å·²ä¸‹è½½çš„å±‚ï¼Œé‡å¤ä¸‹è½½ç§’é€Ÿå®Œæˆ
- ğŸ” **èº«ä»½éªŒè¯** - æ”¯æŒå…¬å…±å’Œç§æœ‰ Docker Registry
- ğŸ–¥ï¸ **å¤šæ¶æ„** - æ”¯æŒ amd64ã€arm64 ç­‰å¤šç§æ¶æ„

## ğŸ“¦ å®‰è£…

```bash
# ä»æºç ç¼–è¯‘
go build -o dip .
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æ‹‰å–é•œåƒ
dip -i nginx:latest

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
dip -i nginx:latest -o nginx.tar

# ä½¿ç”¨5ä¸ªå¹¶å‘ä¸‹è½½
dip -i nginx:latest -c 5

# æ‹‰å–æŒ‡å®šæ¶æ„çš„é•œåƒ
dip -i nginx:latest -a arm64

# ä»ç§æœ‰ä»“åº“æ‹‰å–ï¼ˆéœ€è¦è®¤è¯ï¼‰
dip -i private-registry.com/myapp:v1.0 -u user -p pass
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | æè¿° | é»˜è®¤å€¼ |
|------|------|------|--------|
| `-i` | | Dockeré•œåƒåç§° | æ— ï¼Œå¿…é¡»æŒ‡å®š |
| `-o` | | è¾“å‡ºæ–‡ä»¶è·¯å¾„ | repository-tag-arch.tar |
| `-r` | | Docker Registryåœ°å€ | registry-1.docker.io |
| `-u` | | Registryç”¨æˆ·å | ç©º |
| `-p` | | Registryå¯†ç  | ç©º |
| `-a` | | é•œåƒæ¶æ„ (amd64, arm64ç­‰) | amd64 |
| `-c` | | å¹¶å‘ä¸‹è½½æ•° (1-10) | 3 |
| `-m` | | é•œåƒåŠ é€Ÿå™¨åœ°å€åˆ—è¡¨ | å†…ç½®åŠ é€Ÿå™¨ |
| `-k` | | å…è®¸ä¸å®‰å…¨çš„HTTPSè¿æ¥ | false |
| `--retry` | | ä¸‹è½½å¤±è´¥é‡è¯•æ¬¡æ•° | 3 |
| `--timeout` | | ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | 300 |
| `--cache-dir` | | å±‚ç¼“å­˜ç›®å½• | ~/.docker-pull/cache |
| `--version` | | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ | - |

### é•œåƒåç§°æ ¼å¼

æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

- `nginx` - ä» Docker Hub æ‹‰å–æœ€æ–°ç‰ˆæœ¬
- `nginx:1.19` - ä» Docker Hub æ‹‰å–æŒ‡å®šæ ‡ç­¾ç‰ˆæœ¬
- `registry.example.com/nginx` - ä»è‡ªå®šä¹‰ Registry æ‹‰å–
- `registry.example.com:5000/nginx:1.19` - å¸¦ç«¯å£çš„è‡ªå®šä¹‰ Registry

## ğŸ“‹ ç¤ºä¾‹

### æ‹‰å– Nginx é•œåƒ

```bash
dip -i nginx:latest
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
========================================
é•œåƒ: library/nginx:latest
æ¶æ„: amd64
ä»“åº“: registry-1.docker.io
å¹¶å‘æ•°: 3
é‡è¯•æ¬¡æ•°: 3
é•œåƒåŠ é€Ÿå™¨: docker.gh-proxy.com, docker.1ms.run, docker.xjyi.me
========================================
æ­£åœ¨è·å–é•œåƒæ¸…å•...
âœ“ ä½¿ç”¨é•œåƒåŠ é€Ÿå™¨: docker.gh-proxy.com
å‘ç° 7 ä¸ªé•œåƒå±‚ï¼Œä½¿ç”¨ 3 ä¸ªå¹¶å‘ä¸‹è½½
è¿›åº¦: [7/7å±‚] 65.2 MB / 65.2 MB (12.50 MB/s)
âœ“ æ‰€æœ‰ 7 ä¸ªå±‚ä¸‹è½½å®Œæˆ
æ­£åœ¨åˆ›å»ºé•œåƒæ–‡ä»¶...
========================================
âœ“ é•œåƒå·²æˆåŠŸä¿å­˜åˆ°: library_nginx-latest-amd64.tar
âœ“ æ–‡ä»¶å¤§å°: 187.45 MB
========================================
```

### åŠ è½½åˆ° Docker

```bash
# æ‹‰å–é•œåƒ
dip -i nginx:latest

# åŠ è½½åˆ° Docker
docker load -i library_nginx-latest-amd64.tar
```

### é«˜çº§ç”¨æ³•

```bash
# ä½¿ç”¨5ä¸ªå¹¶å‘ï¼Œæœ€å¤šé‡è¯•5æ¬¡
dip -i nginx:latest -c 5 --retry 5

# æŒ‡å®šè¶…æ—¶æ—¶é—´ä¸º10åˆ†é’Ÿ
dip -i large-image:latest --timeout 600

# ç¦ç”¨é•œåƒåŠ é€Ÿå™¨
dip -i nginx:latest -m ""

# ä½¿ç”¨è‡ªå®šä¹‰åŠ é€Ÿå™¨
dip -i nginx:latest -m "mirror1.example.com,mirror2.example.com"
```

## ğŸ”§ ç¯å¢ƒå˜é‡

| å˜é‡å | æè¿° |
|--------|------|
| `DOCKER_PULL_MIRRORS` | é•œåƒåŠ é€Ÿå™¨åœ°å€åˆ—è¡¨ï¼Œé€—å·åˆ†éš” |

## ğŸ“„ ç‰ˆæœ¬å†å²

### v0.2.0
- âœ¨ æ–°å¢å¹¶å‘ä¸‹è½½åŠŸèƒ½
- âœ¨ æ–°å¢ä¸‹è½½é‡è¯•æœºåˆ¶
- âœ¨ æ–°å¢é•œåƒå®Œæ•´æ€§éªŒè¯
- âœ¨ ä¼˜åŒ–è¿›åº¦æ˜¾ç¤ºï¼ˆæ€»ä½“è¿›åº¦ï¼‰
- ğŸ”§ ä¼˜åŒ– HTTP å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®
- ğŸ”§ ä¿®å¤æ¶æ„ç¡¬ç¼–ç é—®é¢˜
- ğŸ”§ ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ä¸ºä¸­æ–‡

### v0.1.0
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ